head: &head
  operationId: getMonitoringSetsHeaders
  description: >
    Use to obtain the headers that would be returned for  `getMonitoringSets`.
    Useful for cache invalidation.
  summary: Get the headers for the current list of Monitoring Sets
  tags: &tags
    - Monitoring Sets
  responses:
    $ref: ../components/responses/read-head.yaml

  security: &read-authorization
    - oauth2-primary-flow:
        - read:monitoring-sets
get:
  <<: *head
  operationId: getMonitoringSets
  description: >
    Obtain the list of monitoring sets visible to this user.  

    Clients SHOULD perform Conditional `GET` using the `If-None-Match` header
    and the `ETag` of a previous `GET` response.
  summary: Get the list of known Monitoring Sets
  responses:
    '200':
      description: OK
      content:
        application/vnd.trolie.monitoring-set-list.v1+json:
          schema:
            $ref: ../components/schemas/monitoring-set-list.yaml
          example:
            - utilityA-and-neighbors
            - utilityB-and-neighbors
        application/json:
          schema:
            $ref: ../components/schemas/monitoring-set-list.yaml
      headers:
        $ref: '../openapi-split.yaml#/components/responses/200/headers'

    '304':
      $ref: '../openapi-split.yaml#/components/responses/304'
    '400': &malformed
      $ref: '../openapi-split.yaml#/components/responses/400-problem'
    '401': &unauthorized-empty
      $ref: '../openapi-split.yaml#/components/responses/401-empty'
    '403': &forbidden-empty
      $ref: '../openapi-split.yaml#/components/responses/403-empty'
    '404': &not-found-empty
      $ref: '../openapi-split.yaml#/components/responses/404-empty'
    '406': &not-acceptable-empty
      $ref: '../openapi-split.yaml#/components/responses/406-empty'
    '410':
      $ref: '../openapi-split.yaml#/components/responses/410-empty'
    '429': &rate-limit-hit
      $ref: '../openapi-split.yaml#/components/responses/429-empty'
    '500': &unexpected-error-empty
      $ref: '../openapi-split.yaml#/components/responses/500-empty'
    default: *unexpected-error-empty

  security: *read-authorization

post:
  operationId: createMonitoringSet
  description: &post_desc Create a new Monitoring Set
  summary: *post_desc
  tags: *tags
  requestBody:
    content:
      application/vnd.trolie.monitoring-set.v1+json:
        schema:
          $ref: "../components/schemas/array-max-monitored-elements.yaml#/monitoring-set"
        example:
          id: utilityA-and-neighbors
          description: Utility A's owned lines, as well as surround neighbors.
          transmission-facilities:
            - line1
            - line2
            - line3
      application/json:
        schema:
          $ref: "../components/schemas/array-max-monitored-elements.yaml#/monitoring-set"
  responses:
    '201':
      description: The monitoring set was created.
      content:
        application/json:
          schema:
            $ref: "../components/schemas/array-max-monitored-elements.yaml#/monitoring-set"
        application/vnd.trolie.monitoring-set.v1+json:
          schema:
            $ref: "../components/schemas/array-max-monitored-elements.yaml#/monitoring-set"
      headers:
        $ref: '../openapi-split.yaml#/components/responses/200/headers'

    '400': *malformed
    '401': *unauthorized-empty
    '403': *forbidden-empty
    '404': *not-found-empty
    '406': *not-acceptable-empty
    '413':
      $ref: '../openapi-split.yaml#/components/responses/413-empty'
    '422':
      $ref: '../openapi-split.yaml#/components/responses/422-problem'
    '429': *rate-limit-hit
    '500': *unexpected-error-empty
    default: *unexpected-error-empty
  security:
    - oauth2-primary-flow:
        - write:monitoring-sets
